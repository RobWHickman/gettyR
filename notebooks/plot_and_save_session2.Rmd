---
title: "plot and save 2"
author: "Robert Hickman"
date: "03/09/2020"
output: html_document
---

```{r libraries, warning=FALSE,message=FALSE}
library(tidyverse)
library(tidymodels)
library(patchwork)
library(gettyR)

```

```{r directories, warning=FALSE,message=FALSE}
dir <- "C:/Users/DHill/Desktop/robert_cell_sorting/sessions"
session <- "U-2020-07-30-s2"

dir <- "C:/Users/DHill/Desktop/test_uly_data"
session <- "test_session"


spike_data <- gettyR::open_spike_data(dir, session) 
trace_data <- gettyR::open_cell_trace(dir)

```

```{r}
cells <- unique(unlist(spike_data$sorted_spikes) %>%
           .[grepl("^cell", .)])

create_spike_dirs(dir = dir, session, cells)
```
```{r plot_unsorted_data, warning=FALSE,message=FALSE}
bits <- c("free_reward", "fixation_cross", "win_lose", "fractal_display")
situations <- c(4, 2, 2, 2)

walk2(bits, situations,
      function(b, s) {
        p <- plot_getty_responses(spike_data, s, b)
        path <- paste0(file.path(dir, session, "figures/unsorted_responses", b), ".png")
        ggsave(plot = p, filename = path, device = "png")
      })

```

```{r plot_cells}
cells <- unique(trace_data$cell)
walk(cells, gettyR::plot_and_save_cluster_data, session_folder = session, dir_folder = dir)
gettyR::plot_and_save_cluster_data(NULL, session_folder = session, dir_folder = dir)
```

```{r individual_cell_responses}

```

